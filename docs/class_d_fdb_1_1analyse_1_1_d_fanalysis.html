<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DFdb Documentation: DFdb.analyse.DFanalysis Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DFdb Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('class_d_fdb_1_1analyse_1_1_d_fanalysis.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="class_d_fdb_1_1analyse_1_1_d_fanalysis-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">DFdb.analyse.DFanalysis Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handles analysis and plotting of comparative results.  
 <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for DFdb.analyse.DFanalysis:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis__coll__graph.png" border="0" usemap="#a_d_fdb_8analyse_8_d_fanalysis_coll__map" alt="Collaboration graph"/></div>
<map name="a_d_fdb_8analyse_8_d_fanalysis_coll__map" id="a_d_fdb_8analyse_8_d_fanalysis_coll__map">
<area shape="rect" title="Handles analysis and plotting of comparative results." alt="" coords="5,5,183,171"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab31c59b13440f2e7f87ea89c54585741"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#ab31c59b13440f2e7f87ea89c54585741">__init__</a> (self, <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a1abf06bd44f595f62f28a946547157b0">skl_kde_samples</a>=10000)</td></tr>
<tr class="memdesc:ab31c59b13440f2e7f87ea89c54585741"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html" title="Handles analysis and plotting of comparative results.">DFanalysis</a> object.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#ab31c59b13440f2e7f87ea89c54585741">More...</a><br /></td></tr>
<tr class="separator:ab31c59b13440f2e7f87ea89c54585741"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2193b9959e668738e07d9a011e410c8b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a2193b9959e668738e07d9a011e410c8b">plot_position_difference</a> (self, reference, comparisons, ignore_H=False, plot_type='hist', reference_name=None, comparison_names=None, title=None, return_data=False, savefig=None)</td></tr>
<tr class="memdesc:a2193b9959e668738e07d9a011e410c8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plot the lRMSDs of atomic positions between the molecules in <a class="el" href="namespace_d_fdb.html">DFdb</a> sets compared to a reference set.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a2193b9959e668738e07d9a011e410c8b">More...</a><br /></td></tr>
<tr class="separator:a2193b9959e668738e07d9a011e410c8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a389811818193feaeae4971730e4890c5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a389811818193feaeae4971730e4890c5">plot_force_difference</a> (self, reference, comparisons, plot_type='hist', reference_name=None, comparison_names=None, title=None, return_data=False, savefig=None)</td></tr>
<tr class="memdesc:a389811818193feaeae4971730e4890c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plot the RMSDs of atomic forces between the molecules in <a class="el" href="namespace_d_fdb.html">DFdb</a> sets compared to a reference set.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a389811818193feaeae4971730e4890c5">More...</a><br /></td></tr>
<tr class="separator:a389811818193feaeae4971730e4890c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa511144de588c1f1b3b3c8b66aeea81b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#aa511144de588c1f1b3b3c8b66aeea81b">plot_energy_difference</a> (self, reference_set, comparison_sets, plot_type='hist', reference_name=None, comparison_names=None, title=None, return_data=False, savefig=None)</td></tr>
<tr class="memdesc:aa511144de588c1f1b3b3c8b66aeea81b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plot the energy differences between identically structured molecules in <a class="el" href="namespace_d_fdb.html">DFdb</a> sets compared to a reference set.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#aa511144de588c1f1b3b3c8b66aeea81b">More...</a><br /></td></tr>
<tr class="separator:aa511144de588c1f1b3b3c8b66aeea81b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a1abf06bd44f595f62f28a946547157b0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a1abf06bd44f595f62f28a946547157b0">skl_kde_samples</a></td></tr>
<tr class="memdesc:a1abf06bd44f595f62f28a946547157b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">int  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a1abf06bd44f595f62f28a946547157b0">More...</a><br /></td></tr>
<tr class="separator:a1abf06bd44f595f62f28a946547157b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a5a3e24f866b66faca3cb57c0bc1b9234"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5a3e24f866b66faca3cb57c0bc1b9234">_compare_positions</a> (self, arl1, arl2, ignore_H=False)</td></tr>
<tr class="memdesc:a5a3e24f866b66faca3cb57c0bc1b9234"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the (least)RMSDs of atomic positions between the molecules in two <a class="el" href="namespace_d_fdb.html">DFdb</a> sets.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5a3e24f866b66faca3cb57c0bc1b9234">More...</a><br /></td></tr>
<tr class="separator:a5a3e24f866b66faca3cb57c0bc1b9234"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fdea4dbbfe2611fb9b193d708b07073"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5fdea4dbbfe2611fb9b193d708b07073">_compare_forces</a> (self, arl1, arl2)</td></tr>
<tr class="memdesc:a5fdea4dbbfe2611fb9b193d708b07073"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the RMSDs of atomic forces between the molecules in two <a class="el" href="namespace_d_fdb.html">DFdb</a> sets.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5fdea4dbbfe2611fb9b193d708b07073">More...</a><br /></td></tr>
<tr class="separator:a5fdea4dbbfe2611fb9b193d708b07073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a103d084d38614a6fd33388eeb26aedb1"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a103d084d38614a6fd33388eeb26aedb1">_compare_energies</a> (self, arl1, arl2)</td></tr>
<tr class="memdesc:a103d084d38614a6fd33388eeb26aedb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare relative energies of the molecules in two <a class="el" href="namespace_d_fdb.html">DFdb</a> sets.  <a href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a103d084d38614a6fd33388eeb26aedb1">More...</a><br /></td></tr>
<tr class="separator:a103d084d38614a6fd33388eeb26aedb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handles analysis and plotting of comparative results. </p>
<p>Contains functions to extract a range of comparative properties from lists of AtomsRows, as well as plotting functions to combine their outputs into publication-quality graphs.</p>
<pre class="fragment">        Number of samples to evaluate Scikit-learn KDE plots over
        when calculating sample means and vaiances.
</pre> 
<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00034">34</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ab31c59b13440f2e7f87ea89c54585741"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab31c59b13440f2e7f87ea89c54585741">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>skl_kde_samples</em> = <code>10000</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html" title="Handles analysis and plotting of comparative results.">DFanalysis</a> object. </p>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00040">40</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keyword">def </span>plot_position_difference(self, reference, comparisons, ignore_H=False, plot_type=&#39;hist&#39;,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                 reference_name=None, comparison_names=None, title=None,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                                 return_data=False, savefig=None):</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Plot the lRMSDs of atomic positions between the molecules in DFdb sets compared to a reference set.</span></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a2193b9959e668738e07d9a011e410c8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2193b9959e668738e07d9a011e410c8b">&#9670;&nbsp;</a></span>plot_position_difference()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis.plot_position_difference </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>comparisons</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ignore_H</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>plot_type</em> = <code>'hist'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference_name</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>comparison_names</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>title</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>return_data</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>savefig</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plot the lRMSDs of atomic positions between the molecules in <a class="el" href="namespace_d_fdb.html">DFdb</a> sets compared to a reference set. </p>
<pre class="fragment">   Either uses Seaborn to produce a rough histogram or histogram+KDE plot, or
   uses Scikit-learn to fit an accurate KDE plot and report mean and variance
   of the resulting data.

   Return 0 is a Pandas DataFrame containing the accurate results from the KDE fit
   if the Scikit-learn implementation is used, else return 0 is None. Return 1 is
   a Pandas DataFrame of all the position lRMSDs if return_data is true, else return 1 is
   None.
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">reference</td><td>list List of AtomsRows with identical chemical formulae to those in comparison. </td></tr>
    <tr><td class="paramname">comparisons</td><td>list List of comparative lists of AtomsRows with identical chemical formulae to those in reference. </td></tr>
    <tr><td class="paramname">ignore_H</td><td>boolean; Default: False Whether to ignore hydrogens in the RMSD calculation. </td></tr>
    <tr><td class="paramname">plot_type</td><td>str; Default: hist; Choices: [hist, hist+kde, kde] The type of plot to produce. </td></tr>
    <tr><td class="paramname">reference_name</td><td>str; Optional Name of the reference dataset. </td></tr>
    <tr><td class="paramname">comparison_names</td><td>list of strings; Optional List of names of the comparison datasets. </td></tr>
    <tr><td class="paramname">title</td><td>str; Optional Figure title for the graph. </td></tr>
    <tr><td class="paramname">return_data</td><td>boolean; Default: False Whether to include a DataFrame of all the lRMSD data used in plotting. </td></tr>
    <tr><td class="paramname">savefig</td><td>str or None; Optional Whether to save the figure to file. Leaving as None means no saving, otherwise a string containing the path to save to should be passed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>If the Scikit-learn implementation is used, the first return value is a Pandas DataFrame containing the accurate results from the KDE fit. Otherwise, this value returns None. If return_data is True then the second return value is a Pandas DataFrame of all the position lRMSDs, otherwise this value returns None. </dd></dl>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00085">85</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <span class="stringliteral">&#39;hist+kde&#39;</span>,</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="stringliteral">&#39;kde&#39;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        ]</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span> plot_type <span class="keywordflow">not</span> <span class="keywordflow">in</span> plot_types:</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Unrecognised plot_type! Must be one of [hist, hist+kde, kde].&#39;</span>)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">raise</span> Err</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment"># Check there are the correct number of comparison_names for the number of datasets, if names are provided.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        num_plots = len(comparisons)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> comparison_names:</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> len(comparison_names)==num_plots:</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Number of strings in comparison_names doesn\&#39;t match number of comparative lists.&#39;</span>)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment"># Check that savefig is valid, if present.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">if</span> savefig:</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">if</span> type(savefig) <span class="keywordflow">is</span> <span class="keywordflow">not</span> str:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Argument savefig should be None or a string.&#39;</span>)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment"># Calculate lRMSDs for each comparative dataset.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        rmsds = [self._compare_positions(reference, comparison, ignore_H) <span class="keywordflow">for</span> comparison <span class="keywordflow">in</span> comparisons]</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment"># Gather struct_name data if needed.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">if</span> return_data:</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            mol_names = [row.struct_name <span class="keywordflow">for</span> row <span class="keywordflow">in</span> reference]</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        output = [<span class="keywordtype">None</span>, <span class="keywordtype">None</span>]</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment"># Plot results.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span> plot_type == <span class="stringliteral">&#39;kde&#39;</span>:</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="comment"># Generate an accurate KDE plot with Scikit-learn and report mean/variance.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            fig, ax = plt.subplots(1, num_plots, sharey=<span class="keyword">True</span>, constrained_layout=<span class="keyword">True</span>, figsize=(10*num_plots, 10))</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            sample_means = np.zeros(num_plots)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            means = np.zeros(num_plots)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            sample_variances = np.zeros(num_plots)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            variances = np.zeros(num_plots)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            sample_stdevs = np.zeros(num_plots)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            stdevs = np.zeros(num_plots)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordflow">for</span> i, rmsd_list <span class="keywordflow">in</span> enumerate(rmsds):</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                x = np.linspace(min(rmsd_list), max(rmsd_list), 1000)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                bandwidths = 10**np.linspace(-1, 1, 100)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                grid = GridSearchCV(KernelDensity(kernel=<span class="stringliteral">&#39;gaussian&#39;</span>), {<span class="stringliteral">&#39;bandwidth&#39;</span>: bandwidths}, cv=LeaveOneOut().split(rmsd_list))</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                grid.fit(rmsd_list[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                kde = KernelDensity(bandwidth=grid.best_params_[<span class="stringliteral">&#39;bandwidth&#39;</span>], kernel=<span class="stringliteral">&#39;gaussian&#39;</span>)</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                kde.fit(rmsd_list[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                logprob = kde.score_samples(x[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                means[i] = np.mean(rmsd_list)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                variances[i] = np.var(rmsd_list)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                stdevs[i] = np.sqrt(variances[i])</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                sample_means[i] = np.mean(kde.sample(self.skl_kde_samples))</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                sample_variances[i] = np.var(kde.sample(self.skl_kde_samples))</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                sample_stdevs[i] = np.sqrt(sample_variances[i])</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                ax[i].fill_between(x, np.exp(logprob), alpha=0.5)</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">if</span> i == 0:</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    ax[i].set_ylabel(<span class="stringliteral">&#39;Probability&#39;</span>)</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                ax[i].set_xlabel(<span class="stringliteral">r&#39;lRMSD of atomic positions ($\AA$/atom)&#39;</span>)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="keywordflow">if</span> reference_name <span class="keywordflow">and</span> comparison_names:</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    ax[i].set_title(f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span>)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="comment"># Assemble DataFrame of statistical information for the KDE plot.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            stats_df = pd.DataFrame({</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="stringliteral">&#39;Comparison&#39;</span>: [f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_plots)],</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="stringliteral">&#39;Raw Data Mean&#39;</span>: means,</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                <span class="stringliteral">&#39;Sample Mean&#39;</span>: sample_means, </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="stringliteral">&#39;Raw Data Variance&#39;</span>: variances,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                <span class="stringliteral">&#39;Sample Variance&#39;</span>: sample_variances,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="stringliteral">&#39;Raw Data Stdev&#39;</span>: stdevs,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <span class="stringliteral">&#39;Sample Stdev&#39;</span>: sample_stdevs</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            })</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            output[0] = stats_df</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="comment"># Generate a rough histogram/KDE plot with seaborn.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            fig, ax = plt.subplots(1, num_plots, sharey=<span class="keyword">True</span>, constrained_layout=<span class="keyword">True</span>, figsize=(10*num_plots, 10))</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">for</span> i, rmsd_list <span class="keywordflow">in</span> enumerate(rmsds):</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                sns.histplot(rmsd_list, bins=15, kde=(<span class="keyword">True</span> <span class="keywordflow">if</span> plot_type==<span class="stringliteral">&#39;hist+kde&#39;</span> <span class="keywordflow">else</span> <span class="keyword">False</span>), ax=ax[i])</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                ax[i].set_xlabel(<span class="stringliteral">r&#39;lRMSD of atomic positions ($\AA$/atom)&#39;</span>)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                <span class="keywordflow">if</span> reference_name <span class="keywordflow">and</span> comparison_names:</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    ax[i].set_title(f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span>)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">if</span> title:</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            fig.suptitle(title)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span> savefig:</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            fig.savefig(savefig, dpi=300)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        plt.show()</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment"># Assemble the full labelled lRMSD DataFrame is requested.</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span> return_data:</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            data1 = pd.DataFrame(mol_names, columns=[<span class="stringliteral">&#39;struct_name&#39;</span>])</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            data2 = pd.DataFrame(np.array(rmsds).T, columns=[f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_plots)])</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            data3 = pd.concat([data1, data2], axis=1)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            output[1] = data3</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">return</span> output[0], output[1]</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">def </span>_compare_positions(self, arl1, arl2, ignore_H=False):</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Calculate the (least)RMSDs of atomic positions between the molecules in two DFdb sets.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral">        The molecules in each of the sets should be calculated from the </span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5a3e24f866b66faca3cb57c0bc1b9234">DFdb.analyse.DFanalysis._compare_positions()</a>, and <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a1abf06bd44f595f62f28a946547157b0">DFdb.analyse.DFanalysis.skl_kde_samples</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis_a2193b9959e668738e07d9a011e410c8b_cgraph.png" border="0" usemap="#aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a2193b9959e668738e07d9a011e410c8b_cgraph" alt=""/></div>
<map name="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a2193b9959e668738e07d9a011e410c8b_cgraph" id="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a2193b9959e668738e07d9a011e410c8b_cgraph">
<area shape="rect" title="Plot the lRMSDs of atomic positions between the molecules in DFdb sets compared to a reference set." alt="" coords="5,5,196,47"/>
<area shape="rect" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5a3e24f866b66faca3cb57c0bc1b9234" title="Calculate the (least)RMSDs of atomic positions between the molecules in two DFdb sets." alt="" coords="244,5,415,47"/>
</map>
</div>

</div>
</div>
<a id="a5a3e24f866b66faca3cb57c0bc1b9234"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a3e24f866b66faca3cb57c0bc1b9234">&#9670;&nbsp;</a></span>_compare_positions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis._compare_positions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arl1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arl2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ignore_H</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the (least)RMSDs of atomic positions between the molecules in two <a class="el" href="namespace_d_fdb.html">DFdb</a> sets. </p>
<pre class="fragment">   The molecules in each of the sets should be calculated from the
   same structure files to ensure identical atomic mapping.
</pre><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arl1</td><td>list List of AtomsRows containing a set of AtomsRows with identical chemical formulae to those in ari2. </td></tr>
    <tr><td class="paramname">arl2</td><td>list List of AtomsRows containing a set of AtomsRows with identical chemical formulae to those in ari1. </td></tr>
    <tr><td class="paramname">ignore_H</td><td>boolean; Default: False Whether to ignore hydrogens in the RMSD calculation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A list of lRMSDs with a value for each pair of rows in arl1 and arl2. </dd></dl>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00212">212</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment"># Compare through every molecule pair.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">for</span> i, (a1, a2) <span class="keywordflow">in</span> enumerate(zip(arl1, arl2)):</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            mol1 = a1.toatoms()</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            mol2 = a2.toatoms()</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">if</span> len(mol1) != len(mol2):</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&#39;Atoms objects have different lengths! arl1 has length {len(arl1)}, while arl2 has length {len(arl2)}.&#39;</span>)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment"># Rotate/translate mol2 to get the least RMSD.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            minimize_rotation_and_translation(mol1, mol2)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            rmsd = 0.0</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">for</span> j, (atom1, atom2) <span class="keywordflow">in</span> enumerate(zip(mol1, mol2)):</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="keywordflow">if</span> atom1.symbol != atom2.symbol:</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Molecules have different atomic mapping!&#39;</span>)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keywordflow">if</span> ignore_H <span class="keywordflow">and</span> atom1.symbol == <span class="stringliteral">&#39;H&#39;</span>:</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    <span class="keywordflow">continue</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                pos_diff = np.linalg.norm(atom1.position - atom2.position)**2</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                rmsd += pos_diff</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            rmsd *= 1/len(mol1)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            rmsd = np.sqrt(rmsd)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            rmsd_list[i] = rmsd</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">return</span> rmsd_list</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keyword">def </span>plot_force_difference(self, reference, comparisons, plot_type=&#39;hist&#39;,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                              reference_name=None, comparison_names=None, title=None,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                              return_data=False, savefig=None):</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Plot the RMSDs of atomic forces between the molecules in DFdb sets compared</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">        to a reference set.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">        </span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a2193b9959e668738e07d9a011e410c8b">DFdb.analyse.DFanalysis.plot_position_difference()</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis_a5a3e24f866b66faca3cb57c0bc1b9234_icgraph.png" border="0" usemap="#aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a5a3e24f866b66faca3cb57c0bc1b9234_icgraph" alt=""/></div>
<map name="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a5a3e24f866b66faca3cb57c0bc1b9234_icgraph" id="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a5a3e24f866b66faca3cb57c0bc1b9234_icgraph">
<area shape="rect" title="Calculate the (least)RMSDs of atomic positions between the molecules in two DFdb sets." alt="" coords="244,5,415,47"/>
<area shape="rect" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a2193b9959e668738e07d9a011e410c8b" title="Plot the lRMSDs of atomic positions between the molecules in DFdb sets compared to a reference set." alt="" coords="5,5,196,47"/>
</map>
</div>

</div>
</div>
<a id="a389811818193feaeae4971730e4890c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a389811818193feaeae4971730e4890c5">&#9670;&nbsp;</a></span>plot_force_difference()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis.plot_force_difference </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>comparisons</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>plot_type</em> = <code>'hist'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference_name</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>comparison_names</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>title</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>return_data</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>savefig</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plot the RMSDs of atomic forces between the molecules in <a class="el" href="namespace_d_fdb.html">DFdb</a> sets compared to a reference set. </p>
<p>Either uses Seaborn to produce a rough histogram or histogram+KDE plot, or uses Scikit-learn to fit an accurate KDE plot and report mean and variance of the resulting data.</p>
<p>Return 0 is a Pandas DataFrame containing the accurate results from the KDE fit if the Scikit-learn implementation is used, else return 0 is None. Return 1 is a Pandas DataFrame of all the force RMSDs if return_data is true, else return 1 is None.</p>
<dl class="section user"><dt>Parameters</dt><dd></dd></dl>
<p>reference List of AtomsRows with identical chemical formulae to those in comparison. comparisons List of comparative lists of AtomsRows with identical chemical formulae to those in reference. plot_type (Default: hist, Choices: [hist, hist+kde, kde]) The type of plot to produce. reference_name (Optional) Name of the reference dataset. comparison_names (Optional) List of names of the comparison datasets. title (Optional) Figure title for the graph. return_data (Default: False) Whether to include a DataFrame of all the lRMSD data used in plotting. savefig (Optional) Whether to save the figure to file. Leaving as None means no saving, otherwise a string containing the path to save to should be passed. </p>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00272">272</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        ]</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">if</span> plot_type <span class="keywordflow">not</span> <span class="keywordflow">in</span> plot_types:</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Unrecognised plot_type! Must be one of [hist, hist+kde, kde].&#39;</span>)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        num_plots = len(comparisons)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> comparison_names:</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> len(comparison_names)==num_plots:</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Number of strings in comparison_names doesn\&#39;t match number of comparative lists.&#39;</span>)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment"># Check that savefig is valid, if present.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">if</span> savefig:</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">if</span> type(savefig) <span class="keywordflow">is</span> <span class="keywordflow">not</span> str:</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Argument savefig should be None or a string.&#39;</span>)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment"># Calculate RMSDs for each comparative dataset.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        rmsds = [self._compare_forces(reference, comparison) <span class="keywordflow">for</span> comparison <span class="keywordflow">in</span> comparisons]</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment"># Gather struct_name data if needed.</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span> return_data:</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            mol_names = [row.struct_name <span class="keywordflow">for</span> row <span class="keywordflow">in</span> reference]</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        output = [<span class="keywordtype">None</span>, <span class="keywordtype">None</span>]</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment"># Plot figure.</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">if</span> plot_type == <span class="stringliteral">&#39;kde&#39;</span>:</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="comment"># Generate an accurate KDE plot with Scikit-learn and report mean/variance.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            fig, ax = plt.subplots(1, num_plots, sharey=<span class="keyword">True</span>, constrained_layout=<span class="keyword">True</span>, figsize=(10*num_plots, 10))</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            sample_means = np.zeros(num_plots)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            means = np.zeros(num_plots)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            sample_variances = np.zeros(num_plots)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            variances = np.zeros(num_plots)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            sample_stdevs = np.zeros(num_plots)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            stdevs = np.zeros(num_plots)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">for</span> i, rmsd_list <span class="keywordflow">in</span> enumerate(rmsds):</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                x = np.linspace(min(rmsd_list), max(rmsd_list), 1000)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                bandwidths = 10**np.linspace(-1, 1, 100)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                grid = GridSearchCV(KernelDensity(kernel=<span class="stringliteral">&#39;gaussian&#39;</span>), {<span class="stringliteral">&#39;bandwidth&#39;</span>: bandwidths}, cv=LeaveOneOut().split(rmsd_list))</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                grid.fit(rmsd_list[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                kde = KernelDensity(bandwidth=grid.best_params_[<span class="stringliteral">&#39;bandwidth&#39;</span>], kernel=<span class="stringliteral">&#39;gaussian&#39;</span>)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                kde.fit(rmsd_list[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                logprob = kde.score_samples(x[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                means[i] = np.mean(rmsd_list)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                variances[i] = np.var(rmsd_list)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                stdevs[i] = np.sqrt(variances[i])</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                sample_means[i] = np.mean(kde.sample(self.skl_kde_samples))</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                sample_variances[i] = np.var(kde.sample(self.skl_kde_samples))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                sample_stdevs[i] = np.sqrt(sample_variances[i])</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                ax[i].fill_between(x, np.exp(logprob), alpha=0.5)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="keywordflow">if</span> i == 0:</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    ax[i].set_ylabel(<span class="stringliteral">&#39;Probability&#39;</span>)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                ax[i].set_xlabel(<span class="stringliteral">r&#39;RMSD of atomic forces ($eV/\AA$/atom)&#39;</span>)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="keywordflow">if</span> reference_name <span class="keywordflow">and</span> comparison_names:</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    ax[i].set_title(f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span>)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="comment"># Assemble DataFrame of statistical information for the KDE plot.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            stats_df = pd.DataFrame({</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                <span class="stringliteral">&#39;Comparison&#39;</span>: [f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_plots)],</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="stringliteral">&#39;Raw Data Mean&#39;</span>: means,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="stringliteral">&#39;Sample Mean&#39;</span>: sample_means, </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="stringliteral">&#39;Raw Data Variance&#39;</span>: variances,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="stringliteral">&#39;Sample Variance&#39;</span>: sample_variances,</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="stringliteral">&#39;Raw Data Stdev&#39;</span>: stdevs,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                <span class="stringliteral">&#39;Sample Stdev&#39;</span>: sample_stdevs</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            })</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            output[0] = stats_df</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <span class="comment"># Generate a rough histogram/KDE plot with seaborn.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            fig, ax = plt.subplots(1, num_plots, sharey=<span class="keyword">True</span>, constrained_layout=<span class="keyword">True</span>, figsize=(10*num_plots, 10))</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160; </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">for</span> i, rmsd_list <span class="keywordflow">in</span> enumerate(rmsds):</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                sns.histplot(rmsd_list, bins=15, kde=(<span class="keyword">True</span> <span class="keywordflow">if</span> plot_type==<span class="stringliteral">&#39;hist+kde&#39;</span> <span class="keywordflow">else</span> <span class="keyword">False</span>), ax=ax[i])</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                ax[i].set_xlabel(<span class="stringliteral">r&#39;RMSD of atomic forces ($eV/\AA$/atom)&#39;</span>)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span> reference_name <span class="keywordflow">and</span> comparison_names:</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    ax[i].set_title(f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span>)</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> title:</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            fig.suptitle(title)</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> savefig:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            fig.savefig(savefig, dpi=300)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        plt.show()</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment"># Assemble the full labelled lRMSD DataFrame is requested.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">if</span> return_data:</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            data1 = pd.DataFrame(mol_names, columns=[<span class="stringliteral">&#39;struct_name&#39;</span>])</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            data2 = pd.DataFrame(np.array(rmsds).T, columns=[f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_plots)])</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            data3 = pd.concat([data1, data2], axis=1)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            output[1] = data3</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordflow">return</span> output[0], output[1]</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keyword">def </span>_compare_forces(self, arl1, arl2):</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Calculate the RMSDs of atomic forces between the molecules</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">        in two DFdb sets.</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">        The molecules in each of the sets should be calculated from the </span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">        same structure files to ensure identical atomic mapping.</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5fdea4dbbfe2611fb9b193d708b07073">DFdb.analyse.DFanalysis._compare_forces()</a>, and <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a1abf06bd44f595f62f28a946547157b0">DFdb.analyse.DFanalysis.skl_kde_samples</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis_a389811818193feaeae4971730e4890c5_cgraph.png" border="0" usemap="#aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a389811818193feaeae4971730e4890c5_cgraph" alt=""/></div>
<map name="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a389811818193feaeae4971730e4890c5_cgraph" id="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a389811818193feaeae4971730e4890c5_cgraph">
<area shape="rect" title="Plot the RMSDs of atomic forces between the molecules in DFdb sets compared to a reference set." alt="" coords="5,5,196,47"/>
<area shape="rect" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a5fdea4dbbfe2611fb9b193d708b07073" title="Calculate the RMSDs of atomic forces between the molecules in two DFdb sets." alt="" coords="244,5,415,47"/>
</map>
</div>

</div>
</div>
<a id="a5fdea4dbbfe2611fb9b193d708b07073"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fdea4dbbfe2611fb9b193d708b07073">&#9670;&nbsp;</a></span>_compare_forces()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis._compare_forces </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arl1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arl2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the RMSDs of atomic forces between the molecules in two <a class="el" href="namespace_d_fdb.html">DFdb</a> sets. </p>
<p>The molecules in each of the sets should be calculated from the same structure files to ensure identical atomic mapping.</p>
<dl class="section user"><dt>Parameters</dt><dd></dd></dl>
<p>arl1 List of AtomsRows containing a set of AtomsRows with identical chemical formulae to those in ari2. arl2 List of AtomsRows containing a set of AtomsRows with identical chemical formulae to those in ari1. </p>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00390">390</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">if</span> len(mol1) != len(mol2):</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Atoms objects have different lengths!&#39;</span>)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            forces1 = mol1.get_forces()</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            forces2 = mol2.get_forces()</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            rmsd = 0.0</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordflow">for</span> f1, f2 <span class="keywordflow">in</span> zip(forces1, forces2):</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                force_diff = np.linalg.norm(f1 - f2)**2</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                rmsd += force_diff</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            rmsd *= 1/len(mol1)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            rmsd = np.sqrt(rmsd)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            rmsd_list[i] = rmsd</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">return</span> rmsd_list</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keyword">def </span>plot_energy_difference(self, reference_set, comparison_sets,</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                               plot_type=&#39;hist&#39;, reference_name=None,</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                               comparison_names=None, title=None,</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                               return_data=False, savefig=None):</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Plot the energy differences between identically structured molecules in </span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="stringliteral">        DFdb sets compared to a reference set.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="stringliteral">        Either uses Seaborn to produce a rough histogram or histogram+KDE plot, or</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a389811818193feaeae4971730e4890c5">DFdb.analyse.DFanalysis.plot_force_difference()</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis_a5fdea4dbbfe2611fb9b193d708b07073_icgraph.png" border="0" usemap="#aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a5fdea4dbbfe2611fb9b193d708b07073_icgraph" alt=""/></div>
<map name="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a5fdea4dbbfe2611fb9b193d708b07073_icgraph" id="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a5fdea4dbbfe2611fb9b193d708b07073_icgraph">
<area shape="rect" title="Calculate the RMSDs of atomic forces between the molecules in two DFdb sets." alt="" coords="244,5,415,47"/>
<area shape="rect" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a389811818193feaeae4971730e4890c5" title="Plot the RMSDs of atomic forces between the molecules in DFdb sets compared to a reference set." alt="" coords="5,5,196,47"/>
</map>
</div>

</div>
</div>
<a id="aa511144de588c1f1b3b3c8b66aeea81b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa511144de588c1f1b3b3c8b66aeea81b">&#9670;&nbsp;</a></span>plot_energy_difference()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis.plot_energy_difference </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference_set</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>comparison_sets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>plot_type</em> = <code>'hist'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference_name</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>comparison_names</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>title</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>return_data</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>savefig</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plot the energy differences between identically structured molecules in <a class="el" href="namespace_d_fdb.html">DFdb</a> sets compared to a reference set. </p>
<p>Either uses Seaborn to produce a rough histogram or histogram+KDE plot, or uses Scikit-learn to fit an accurate KDE plot and report mean and variance of the resulting data.</p>
<p>Each unique struct_name in a <a class="el" href="namespace_d_fdb.html">DFdb</a> set must be accompanied by a corresponding energy reference, placed first in that set's list. For example, if there are 4 types of struct_name forming 4 sub-lists in 'reference_set', the first molecule of each sub-list should be a reference structure which all other energies will be compared against, eg. an optimised ground state structure.</p>
<p>Return 0 is a Pandas DataFrame containing the accurate results from the KDE fit if the Scikit-learn implementation is used, else return 0 is None. Return 1 is a Pandas DataFrame containing all of the energy differences if return_data is True, else return 1 is None.</p>
<dl class="section user"><dt>Parameters</dt><dd></dd></dl>
<p>reference_set List of lists of AtomsRows, separated by struct_names. The first entry of each sub-list should be a reliable energy reference. comparison_sets List of comparative lists of AtomsRows, with sub-lists separated by struct_names. The first entry of each sub-list should be a reliable energy reference. plot_type (Default: hist, Choices: [hist, hist+kde, kde]) The type of plot to produce. reference_name (Optional) Name of the reference dataset. comparison_names (Optional) List of names of the comparison datasets. title (Optional) Figure title for the graph. return_data (Default: False) Whether to include a DataFrame of all the lRMSD data used in plotting. savefig (Optional) Whether to save the figure to file. Leaving as None means no saving, otherwise a string containing the path to save to should be passed. </p>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00446">446</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                <span class="keywordflow">if</span> struct_name != <span class="stringliteral">&#39;&#39;</span>:</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    <span class="keywordflow">if</span> struct_name != structure.struct_name:</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                        <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&#39;struct_name mismatch in {struct_name} sub-list of reference_set.&#39;</span>)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                    struct_name = structure.struct_name</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <span class="keywordflow">if</span> i != 0:</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                    all_mol_names.append(struct_name)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">if</span> struct_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> mol_names:</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                mol_names.append(struct_name)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;reference_set contains multiple lists with the same struct_name!&#39;</span>)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        num_mol_types = len(mol_names)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        num_plots = len(comparison_sets)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="comment"># Check that struct_names in all comparison_sets match those in reference_set.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">for</span> s, comparison_set <span class="keywordflow">in</span> enumerate(comparison_sets):</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            temp_names = []</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">for</span> sublist <span class="keywordflow">in</span> comparison_set:</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                struct_name = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                <span class="keywordflow">for</span> structure <span class="keywordflow">in</span> sublist:</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                    <span class="keywordflow">if</span> struct_name != <span class="stringliteral">&#39;&#39;</span>:</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        <span class="keywordflow">if</span> struct_name != structure.struct_name:</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&#39;struct_name mismatch in {struct_name} sub-list of comparison_set {s}.&#39;</span>)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        struct_name = structure.struct_name</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="keywordflow">if</span> struct_name <span class="keywordflow">not</span> <span class="keywordflow">in</span> temp_names:</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                    temp_names.append(struct_name)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;reference_set contains multiple lists with the same struct_name!&#39;</span>)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">for</span> i, name <span class="keywordflow">in</span> enumerate(temp_names):</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                <span class="keywordflow">if</span> name != mol_names[i]:</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    <span class="keywordflow">raise</span> ValueError(f<span class="stringliteral">&#39;struct_names in comparison_set {s} and reference_set do not match!&#39;</span>)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="comment"># Check that plot type is allowed.</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        plot_types = [</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="stringliteral">&#39;hist&#39;</span>,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="stringliteral">&#39;hist+kde&#39;</span>,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <span class="stringliteral">&#39;kde&#39;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        ]</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordflow">if</span> plot_type <span class="keywordflow">not</span> <span class="keywordflow">in</span> plot_types:</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Unrecognised plot_type! Must be one of [hist, hist+kde, kde].&#39;</span>)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment"># Check that there is a name for each of the comparison sets.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> comparison_names:</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> len(comparison_names)==num_plots:</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Number of strings in comparison_names doesn\&#39;t match number of comparative lists.&#39;</span>)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment"># Check that savefig is valid, if present.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> savefig:</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordflow">if</span> type(savefig) <span class="keywordflow">is</span> <span class="keywordflow">not</span> str:</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Argument savefig should be None or a string.&#39;</span>)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        all_energy_diffs_by_set = []</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">for</span> s, comparison_set <span class="keywordflow">in</span> enumerate(comparison_sets):</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            energy_diffs_by_name = []</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">for</span> ref_sublist, comp_sublist <span class="keywordflow">in</span> zip(reference_set, comparison_set):</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                energy_diffs = self._compare_energies(ref_sublist, comp_sublist)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                energy_diffs_by_name.append(energy_diffs)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            all_energy_diffs = np.concatenate(energy_diffs_by_name).ravel()</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            all_energy_diffs_by_set.append(all_energy_diffs)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="comment"># (Finally) plot results.</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        output = [<span class="keywordtype">None</span>, <span class="keywordtype">None</span>]</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">if</span> plot_type == <span class="stringliteral">&#39;kde&#39;</span>:</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            <span class="comment"># Generate an accurate KDE plot with Scikit-learn and report mean/variance.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            fig, ax = plt.subplots(1, num_plots, sharey=<span class="keyword">True</span>, constrained_layout=<span class="keyword">True</span>, figsize=(10*num_plots, 10))</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            sample_means = np.zeros(num_plots)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            means = np.zeros(num_plots)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            sample_variances = np.zeros(num_plots)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            variances = np.zeros(num_plots)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            sample_stdevs = np.zeros(num_plots)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            stdevs = np.zeros(num_plots)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordflow">for</span> i, all_energy_diffs <span class="keywordflow">in</span> enumerate(all_energy_diffs_by_set):</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                x = np.linspace(min(all_energy_diffs), max(all_energy_diffs), 1000)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                bandwidths = 10**np.linspace(-1, 1, 100)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                grid = GridSearchCV(KernelDensity(kernel=<span class="stringliteral">&#39;gaussian&#39;</span>), {<span class="stringliteral">&#39;bandwidth&#39;</span>: bandwidths}, cv=LeaveOneOut().split(all_energy_diffs))</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                grid.fit(all_energy_diffs[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                kde = KernelDensity(bandwidth=grid.best_params_[<span class="stringliteral">&#39;bandwidth&#39;</span>], kernel=<span class="stringliteral">&#39;gaussian&#39;</span>)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                kde.fit(all_energy_diffs[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                logprob = kde.score_samples(x[:, <span class="keywordtype">None</span>])</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                means[i] = np.mean(all_energy_diffs)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                variances[i] = np.var(all_energy_diffs)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                stdevs[i] = np.sqrt(variances[i])</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                sample_means[i] = np.mean(kde.sample(self.skl_kde_samples))</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                sample_variances[i] = np.var(kde.sample(self.skl_kde_samples))</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                sample_stdevs[i] = np.sqrt(sample_variances[i])</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                ax[i].fill_between(x, np.exp(logprob), alpha=0.5)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordflow">if</span> i == 0:</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                    ax[i].set_ylabel(<span class="stringliteral">&#39;Probability&#39;</span>)</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                ax[i].set_xlabel(<span class="stringliteral">&#39;Relative energy difference (eV)&#39;</span>)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                <span class="keywordflow">if</span> reference_name <span class="keywordflow">and</span> comparison_names:</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                    ax[i].set_title(f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span>)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            stats_df = pd.DataFrame({</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="stringliteral">&#39;Comparison&#39;</span>: [f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_plots)],</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                <span class="stringliteral">&#39;Raw Data Mean&#39;</span>: means,</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <span class="stringliteral">&#39;Sample Mean&#39;</span>: sample_means, </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                <span class="stringliteral">&#39;Raw Data Variance&#39;</span>: variances,</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="stringliteral">&#39;Sample Variance&#39;</span>: sample_variances,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="stringliteral">&#39;Raw Data Stdev&#39;</span>: stdevs,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <span class="stringliteral">&#39;Sample Stdev&#39;</span>: sample_stdevs</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            })</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            output[0] = stats_df</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="comment"># Generate a rough histogram/KDE plot with seaborn.</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            fig, ax = plt.subplots(1, num_plots, sharey=<span class="keyword">True</span>, constrained_layout=<span class="keyword">True</span>, figsize=(10*num_plots, 10))</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="keywordflow">for</span> i, all_energy_diffs <span class="keywordflow">in</span> enumerate(all_energy_diffs_by_set):</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                sns.histplot(all_energy_diffs, bins=15, kde=(<span class="keyword">True</span> <span class="keywordflow">if</span> plot_type==<span class="stringliteral">&#39;hist+kde&#39;</span> <span class="keywordflow">else</span> <span class="keyword">False</span>), ax=ax[i])</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                ax[i].set_xlabel(<span class="stringliteral">&#39;Relative energy difference (eV)&#39;</span>)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                <span class="keywordflow">if</span> reference_name <span class="keywordflow">and</span> comparison_names:</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                    ax[i].set_title(f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160; </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="keywordflow">if</span> title:</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            fig.suptitle(title)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span> savefig:</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            fig.savefig(savefig, dpi=300)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        plt.show()</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> return_data:</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            data1 = pd.DataFrame(all_mol_names, columns=[<span class="stringliteral">&#39;struct_name&#39;</span>])</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            data2 = pd.DataFrame(np.array(all_energy_diffs_by_set).T, columns=[f<span class="stringliteral">&#39;{reference_name} vs {comparison_names[i]}&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_plots)])</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            data3 = pd.concat([data1, data2], axis=1)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            output[1] = data3</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">return</span> output[0], output[1]</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keyword">def </span>_compare_energies(self, arl1, arl2):</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="stringliteral">&#39;&#39;&#39;Compare relative energies of the molecules in two DFdb sets.</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="stringliteral">        Energies of each molecule in the sets get defined relative to a reference structure,</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="stringliteral">        eg. to the ground state structure, which will be read from the first AtomsRow. All</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="stringliteral">        molecules in each of the sets AND the reference should have the same chemical formulae.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="stringliteral">        Parameters:</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a103d084d38614a6fd33388eeb26aedb1">DFdb.analyse.DFanalysis._compare_energies()</a>, and <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a1abf06bd44f595f62f28a946547157b0">DFdb.analyse.DFanalysis.skl_kde_samples</a>.</p>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis_aa511144de588c1f1b3b3c8b66aeea81b_cgraph.png" border="0" usemap="#aclass_d_fdb_1_1analyse_1_1_d_fanalysis_aa511144de588c1f1b3b3c8b66aeea81b_cgraph" alt=""/></div>
<map name="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_aa511144de588c1f1b3b3c8b66aeea81b_cgraph" id="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_aa511144de588c1f1b3b3c8b66aeea81b_cgraph">
<area shape="rect" title="Plot the energy differences between identically structured molecules in DFdb sets compared to a refer..." alt="" coords="5,5,196,47"/>
<area shape="rect" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a103d084d38614a6fd33388eeb26aedb1" title="Compare relative energies of the molecules in two DFdb sets." alt="" coords="244,5,415,47"/>
</map>
</div>

</div>
</div>
<a id="a103d084d38614a6fd33388eeb26aedb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a103d084d38614a6fd33388eeb26aedb1">&#9670;&nbsp;</a></span>_compare_energies()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def DFdb.analyse.DFanalysis._compare_energies </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arl1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arl2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare relative energies of the molecules in two <a class="el" href="namespace_d_fdb.html">DFdb</a> sets. </p>
<pre class="fragment">   Energies of each molecule in the sets get defined relative to a reference structure,
   eg. to the ground state structure, which will be read from the first AtomsRow. All
   molecules in each of the sets AND the reference should have the same chemical formulae.
</pre> <dl class="section user"><dt>Parameters</dt><dd></dd></dl>
<p>arl1 List of AtomsRows containing a set of AtomsRows with identical chemical formulae to those in ari2. arl2 List of AtomsRows containing a set of AtomsRows with identical chemical formulae to those in ari1. </p>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00611">611</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            rel_energy = (e1 - re1) - (e2 - re2)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            rel_energy_list[i] = rel_energy</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">return</span> rel_energy_list</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keyword">def </span><a class="code" href="namespace_d_fdb_1_1analyse.html#a9c70e14e01162300e675b89d1a7185e0">ari2list</a>(ari):</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="stringliteral">&#39;&#39;&#39;Converts an AtomsRow Iterator object to a list of AtomsRow objects</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral">    so they can be enumerated over.</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">    If a selection is made directly from the ASE Database object (using DFdatabase.dc.select),</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">    a lazy iterator over AtomsRows will be returned which gets destroyed after </span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="stringliteral">    iterating over for the first time. This iterator also cannot be enumerated</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="stringliteral">    over.</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="stringliteral">    This can be fixed by preconverting the lazy iterator into a list. However,</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="stringliteral">    for large selections this can take up a large amount of memory.</span></div>
<div class="ttc" id="anamespace_d_fdb_1_1analyse_html_a9c70e14e01162300e675b89d1a7185e0"><div class="ttname"><a href="namespace_d_fdb_1_1analyse.html#a9c70e14e01162300e675b89d1a7185e0">DFdb.analyse.ari2list</a></div><div class="ttdeci">def ari2list(ari)</div><div class="ttdoc">Converts an AtomsRow Iterator object to a list of AtomsRow objects so they can be enumerated over.</div><div class="ttdef"><b>Definition:</b> <a href="analyse_8py_source.html#l00642">analyse.py:642</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#aa511144de588c1f1b3b3c8b66aeea81b">DFdb.analyse.DFanalysis.plot_energy_difference()</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_d_fdb_1_1analyse_1_1_d_fanalysis_a103d084d38614a6fd33388eeb26aedb1_icgraph.png" border="0" usemap="#aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a103d084d38614a6fd33388eeb26aedb1_icgraph" alt=""/></div>
<map name="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a103d084d38614a6fd33388eeb26aedb1_icgraph" id="aclass_d_fdb_1_1analyse_1_1_d_fanalysis_a103d084d38614a6fd33388eeb26aedb1_icgraph">
<area shape="rect" title="Compare relative energies of the molecules in two DFdb sets." alt="" coords="244,5,415,47"/>
<area shape="rect" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#aa511144de588c1f1b3b3c8b66aeea81b" title="Plot the energy differences between identically structured molecules in DFdb sets compared to a refer..." alt="" coords="5,5,196,47"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a1abf06bd44f595f62f28a946547157b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1abf06bd44f595f62f28a946547157b0">&#9670;&nbsp;</a></span>skl_kde_samples</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DFdb.analyse.DFanalysis.skl_kde_samples</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>int </p>

<p class="definition">Definition at line <a class="el" href="analyse_8py_source.html#l00041">41</a> of file <a class="el" href="analyse_8py_source.html">analyse.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#aa511144de588c1f1b3b3c8b66aeea81b">DFdb.analyse.DFanalysis.plot_energy_difference()</a>, <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a389811818193feaeae4971730e4890c5">DFdb.analyse.DFanalysis.plot_force_difference()</a>, and <a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html#a2193b9959e668738e07d9a011e410c8b">DFdb.analyse.DFanalysis.plot_position_difference()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>repo/DFdb/<a class="el" href="analyse_8py_source.html">analyse.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_d_fdb.html">DFdb</a></li><li class="navelem"><a class="el" href="namespace_d_fdb_1_1analyse.html">analyse</a></li><li class="navelem"><a class="el" href="class_d_fdb_1_1analyse_1_1_d_fanalysis.html">DFanalysis</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
